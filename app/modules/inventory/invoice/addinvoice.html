<div class="modal-header" ng-init="modalOptions.getAccountConfig();modalOptions.getParty(modalOptions)">
	<button type="button" class="btn btn-danger pull-right buttondistance" ng-click="modalOptions.close()">Close</button>
	<h3  ng-if="!modalOptions.addinvoice.id" class="text-center">Add Invoice</h3>
	<h3  ng-if="modalOptions.addinvoice.id" class="text-center" ng-init="modalOptions.totalCalculate(modalOptions)">Update Invoice</h3>
</div>
<div class="modal-body">
	<form name="generalForm" class="form-horizontal" role="form" novalidate="novalidate" ng-submit="generalForm.$valid" id="generalForm">
		<div class="form-group">
			<div ng-init="modalOptions.getData(false,false,'party','partyList', partyParams, modalOptions)">
				<label for="party_id" class="col-sm-2 control-label">Select Party *</label>
				<div class="col-sm-3">
					<select id="party_id" class="form-control" ng-model="modalOptions.addinvoice.party_id" ng-options="item.id as item.name for item in modalOptions.partyList | filter : {type:'client'}" required>
						<option value="">Select Party</option>
					</select>
					<span class="help-block" ng-show="addInvoiceForm.party_id.$dirty && addInvoiceForm.party_id.$invalid">
					<span ng-show="addInvoiceForm.party_id.$error.required" class="text-danger">user name is required.</span>
					</span>	
				</div>
			</div>
			
			<label  for="generated_date" class="col-sm-3 control-label">Generate Date*</label>
			<div class="col-sm-4">
				<input type="text" class="form-control " placeholder="YYYY-DD-MM" id="generated_date" name="generated_date" ng-model="modalOptions.addinvoice.generated_date"  
				datepicker-popup="{{'dd-MM-yyyy'}}" is-open="opened" min-date="minDate" max-date="maxDate" datepicker-options="dateOptions" ng-init="modalOptions.addinvoice.generated_date = modalOptions.date"  ng-required="true" close-text="Close" ng-click="opened = !opened"/>
			</div>
			<input type="hidden" ng-model="modalOptions.addinvoice.tax" ng-init="modalOptions.addinvoice.tax = modalOptions.singleparticular.tax"/>
			
		</div>
	</form>
	
	<!--THE HIDDEN Generate Date and Due_date and User ID Ends Here-->
	<div class="row">
		<div class="col-sm-12 " ng-init="modalOptions.addinvoice.particulars = (modalOptions.addinvoice.particulars) ? modalOptions.addinvoice.particulars : []">
		
			<form name="addInvoiceForm" class="form-horizontal" role="form" novalidate="novalidate" ng-submit="addInvoiceForm.$valid" id="addInvoiceForm" ng-if="modalOptions.addinvoice.party_id">
				<div class="table-responsive">
					<table class="table table-bordered" >
						<thead>
							<tr>
								<th>Particular Name</th>
								<th>Type</th>
								<th>Category</th>
								<th>Price</th>
								<th>Quantity</th>
								<th>Amount</th>
								<th>Tax</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>
									<input type="text" typeahead-template-url="customTemplate.html" class="form-control" id="particular" name="particular" ng-model="modalOptions.singleparticular.goods_name" typeahead-on-select="modalOptions.assignData($item, modalOptions.singleparticular)" typeahead="stock_items.goods_name for stock_items in modalOptions.getTypeaheadData('stock_items','goods_name', $viewValue)" typeahead-loading="locationLoading" typeahead-editable="false" autocomplete="off" required 
								    placeholder="particulars Name"/>
								
									<span class="help-block" ng-show="addInvoiceForm.particular_name.$dirty && addInvoiceForm.particular_name.$invalid">
									<span ng-show="addInvoiceForm.particular_name.$error.required" class="text-danger">particular_name Required.</span>
									</span>
								</td>

								<script type="text/ng-template" id="customTemplate.html">
									<a>
										<span bind-html-unsafe="match.label | typeaheadHighlight:query"></span> 
										<span><small> ({{match.model.area}} - {{match.model.pincode}})</small></span>
									</a>
								</script>
							
								<td>			
									<select id="goods_type" class="form-control" placeholder="Type" name="goods_type"  ng-model="modalOptions.singleparticular.goods_type" required>
										<option value="" selected>Type</option>
										<option value="type1" >Type1</option>
										<option value="type2">Type2</option>
										<option value="type3">Type3</option>
										<option value="type4">Type4</option>
									</select>
									<span class="help-block" ng-show="addInvoiceForm.goods_type.$dirty && addInvoiceForm.goods_type.$invalid">
										<span ng-show="addInvoiceForm.goods_type.$error.required" class="text-danger">Required field.</span>
									</span>
								</td>
								<td>
									<select id="category" class="form-control" name="category" placeholder="Category" ng-model="modalOptions.singleparticular.category" required>
										<option value="" selected>Category</option>
										<option value="category1">Category1</option>
										<option value="category2">Category2</option>
										<option value="category3">Category3</option>
										<option value="category4">Category4</option>
									</select>
									<span class="help-block" ng-show="addInvoiceForm.category.$dirty && addInvoiceForm.category.$invalid">
										<span ng-show="addInvoiceForm.category.$error.required" class="text-danger">Required field.</span>
									</span>	
								</td>
								<td>
									<input type="text" class="form-control" id="price" name="price" ng-model="modalOptions.singleparticular.price"  placeholder="Price" ng-pattern="/^\d{0,9}(\.\d{0,2}){0,1}$/" required 
									ng-init="modalOptions.singleparticular.amount = (modalOptions.singleparticular.price * modalOptions.singleparticular.quantity)"
									
									ng-change="modalOptions.singleparticular.amount = (modalOptions.singleparticular.price * modalOptions.singleparticular.quantity)"/>
									<span class="help-block" ng-show="addInvoiceForm.price.$dirty && addInvoiceForm.price.$invalid">
									<span ng-show="addInvoiceForm.price.$error.required" class="text-danger">Price Required.</span>
									<span ng-show="addInvoiceForm.price.$error.pattern" class="text-danger">Enter like 0.00 only</span>
									</span>
								</td>
								<td>
									<input type="text" class="form-control " placeholder="Quantity" id="quantity" name="quantity" ng-model="modalOptions.singleparticular.quantity" ng-pattern="/^[1-9]\d{0,9}(\.\d{0,2}){0,1}$/" ng-init="modalOptions.singleparticular.quantity = 1" 
								
									ng-change="modalOptions.singleparticular.amount = (modalOptions.singleparticular.quantity * modalOptions.singleparticular.price)" 
									required/>
									
									<span class="help-block" ng-show="addInvoiceForm.quantity.$dirty && addInvoiceForm.quantity.$invalid">
									<span ng-show="addInvoiceForm.quantity.$error.required" class="text-danger">Quantity Required</span>
									<span ng-show="addInvoiceForm.quantity.$error.pattern" class="text-danger">Enter like 0.00 only</span>
									</span>
								</td>
								<td>
									<input type="text" class="form-control " placeholder="Amount" id="amount" name="amount" ng-model="modalOptions.singleparticular.amount" ng-init="modalOptions.singleparticular.amount" readonly/>
								</td>
								
								<td>
									<button type="button" tooltip="Add Tax" id="tax" class="dropdown dropdown-toggle glyphicon glyphicon-plus" placeholder="Tax" name="tax" value="tax"  ng-click="isCollapsed1 = !isCollapsed1"  ng-pattern="/^\d{0,9}(\.\d{0,2}){0,1}$/" required />
									</button>
									<div collapse="!isCollapsed1" style="z-index:2;position:absolute;right:20px;width:155px;top:70px;padding:1px;" class="well"><!--ng-repeat=x in taxList.config.taxData.tax"-->
										<div class="col-sm-3">
											<div class="form-group" ng-init="modalOptions.taxInfo = {}">
												<ul style="list-style-type:none">
													<li>
														<div class="checkbox col-sm-3 ">
															<label ng-repeat="x in userDetails.config.inventory.taxData.tax">
															<input type="checkbox" ng-model="modalOptions.taxInfo[x.taxName]" ng-change="modalOptions.taxCalculate(modalOptions)" checklist-value="x"/> {{x.displayName}}
															</label>
														</div>
													</li>
												</ul> 
											</div>
										</div>
									</div>
								</td>
							</tr>
						</tbody>
					</table>
				</div>
				<div class="col-sm-4">
						<button type="submit" class="btn btn-success center" ng-disabled="addInvoiceForm.$invalid"  ng-click="modalOptions.addToObject(modalOptions.addinvoice.particulars,'singleparticular', modalOptions);modalOptions.totalCalculate(modalOptions,'addinvoice');">+Add This Particular</button>							
				</div>
			</form>
		</div>
	</div>
</div>	
<div class="table-responsive col-sm-12" ng-if="modalOptions.addinvoice.party_id">
	<table class="table table-bordered">
		<thead>
			<tr>
				<th class="col-sm-2">Sr.No.</th>
				<th class="col-sm-2">Particular Name</th>
				<th class="col-sm-2">Type</th>
				<th class="col-sm-2">Category </th>
				<th class="col-sm-2 text-right">Price</th>
				<th class="col-sm-2 text-right">Quantity</th>
				<th class="col-sm-2 text-right">Amount</th>
				<th class="col-sm-2 text-right">Remove</th>
			</tr>
		</thead>
		<tbody>
			<tr ng-repeat="x in modalOptions.addinvoice.particulars">
				<td>{{ $index + 1 }}</td>
				<td>{{x.goods_name}}</td>
				<td>{{x.goods_type}}</td>
				<td>{{x.category}}</td>
				<td class="text-right">{{x.price}}</td>
				<td class="text-right">{{x.quantity}}</td>
				<td class="text-right">{{x.amount}}</td>
				<td><a ng-click="modalOptions.removeObject(modalOptions.addinvoice.particulars, $index);modalOptions.totalCalculate(modalOptions,'addinvoice');"><span class="glyphicon glyphicon-remove"></span></a></td>
			</tr>
			<tr>
				<td colspan="5"></td>
				<td class="text-right"><strong>Sub Total</strong></td>
				<td class="text-right">{{ modalOptions.addinvoice.subtotal | number : 2}}</td>
				<td></td>
			</tr>
			<tr ng-repeat="(key, value) in modalOptions.addinvoice.tax">
				<td colspan="5"></td>
				<td class="text-right"><strong>{{key.replace("_"," ")|capitalize}}</strong></td>
				<td class="text-right">{{ value  | number : 2}}</td>
				<td></td>
			</tr>
			<tr>
				<td colspan="5"></td>
				<td class="text-right"><strong>Total</strong></td>
				<td class="text-right">{{ modalOptions.addinvoice.total_amount  | number : 2}}</td>
				<td></td>
			</tr>
		</tbody>
	</table>
	<label class="col-sm-3">Remark</label>
	<div class="col-sm-9">
		<textarea class="form-control" id="remark" name="remark" ng-model="modalOptions.addinvoice.remark" ng-maxlength="250" placeholder="Remark" required></textarea>
		<span ng-hide="addInvoiceForm.remark.$error.maxlength">
						{{ 250 - modalOptions.addinvoice.remark.length + " Chars left" }}
		</span>	
		<span class="help-block" ng-show="addInvoiceForm.remark.$dirty && addInvoiceForm.remark.$invalid">
			<span class="text-danger" ng-show="addInvoiceForm.remark.$error.maxlength">Sorry You are Exceeding the Limit</span>
			<span ng-show="addInvoiceForm.remark.$error.required" class="text-danger">Required Field</span>
		</span>
	</div>
</div>

<div class="modal-footer">
	<button type="submit"  class="btn btn-success" ng-if="modalOptions.addinvoice.id"  ng-disabled="addinvoice.$invalid" ng-click="modalOptions.updateData('invoice',modalOptions.addinvoice,modalOptions.addinvoice.id); modalOptions.ok()">Update Invoice</button>

	<button type="submit"  class="btn btn-success" ng-if="!modalOptions.addinvoice.id" ng-disabled="addInvoiceForm.$invalid" ng-click="modalOptions.postData('invoice',modalOptions.addinvoice); modalOptions.ok()">Add Invoice</button>
	
	<button type="button" class="btn btn-warning" ng-click="modalOptions.close()">Cancel</button>
</div>
	